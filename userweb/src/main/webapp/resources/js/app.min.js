function nl2br(e){return e.replace(/(\r\n|\n\r|\r|\n)/g,"<br>")}function loadData(e,t){$("#university").typeahead({items:6,source:universityList,showHintOnFocus:!0}),$("#major").typeahead({items:6,source:majorList,showHintOnFocus:!0});var o={married:{create:function(e){return 1==e.data?"true":"false"}}},a=ko.mapping.fromJS(e,o),n=function(e){var t=ko.mapping.fromJS(e);return t};a.provinceAndCities=new n(ProvinceAndCities),a.currentBirthProvince=function(){for(var e=0;e<a.provinceAndCities().length;e++)if(a.birthProvince()==a.provinceAndCities()[e].name())return a.provinceAndCities()[e];return a.provinceAndCities()[0]},a.currentLiveProvince=function(){for(var e=0;e<a.provinceAndCities().length;e++)if(a.currentProvince()==a.provinceAndCities()[e].name())return a.provinceAndCities()[e];return a.provinceAndCities()[0]},a.enableSave=ko.computed(function(){return a.name().length>0&&a.nameEng()&&a.nameEng().length>0&&a.birthDate()&&a.birthDate().length>0&&a.mobile()&&a.mobile().length>0&&a.major()&&a.major().length>0&&a.universityName()&&a.universityName().length>0&&a.idNo()&&a.idNo().length>0}),a.examCityList=ko.observableArray(t),a.degreeList=ko.observableArray(["College","Undergraduate","Master","MBA","Doctor","Other"]),a.englishLevelList=ko.observableArray(["CET4","CET6","TEM4","TEM8","N/A"]),a.skillLevelList=ko.observableArray(["Average","Good","Very Good","Excellent"]),a.secondLangList=ko.observableArray(["无","日语","法语","德语","韩语","俄语","阿拉伯语","意大利语","西班牙语","葡萄牙语","其他"]),a.saveBasicInfo=function(){var e={name:a.name(),nameEng:a.nameEng(),birthProvince:a.birthProvince(),birthCity:a.birthCity(),birthDate:a.birthDate(),gender:a.gender(),mobile:a.mobile(),email:a.email(),idNo:a.idNo(),married:a.married,currentProvince:a.currentProvince(),currentCity:a.currentCity(),citytoExam:a.citytoExam(),universityName:a.universityName(),degree:a.degree(),major:a.major(),engLevel:a.engLevel(),engHighestScore:a.engHighestScore(),oral:a.oral(),toefl:a.toefl(),toeic:a.toeic(),gre:a.gre(),gmat:a.gmat(),secLanguage:a.secLanguage(),secondLangLevel:a.secondLangLevel()};$.ajax({url:"save_basic",type:"POST",data:JSON.stringify(e),dataType:"json",contentType:"application/json; charset=utf-8",complete:function(){toastr.success("update success!")}})};var r=function(e,t){var o=this;o.id=ko.observable(0),o.fromDate=ko.observable(""),o.toDate=ko.observable(""),o.university=ko.observable(""),o.major=ko.observable(""),o.degree=ko.observable(""),o.degreeList=e.degreeList,o.rankList=[{name:"<5%",value:5},{name:"<10%",value:10},{name:"<20%",value:20},{name:"<30%",value:30},{name:"<50%",value:50}],o.totalRank=ko.observable(10),t&&(o.id(t.id()),o.fromDate(t.fromDate()),o.toDate(t.toDate()),o.university(t.university()),o.major(t.major()),o.degree(t.degree()),o.totalRank(t.totalRank())),o.enableSave=ko.pureComputed(function(){return o.fromDate().length>0&&o.university().length>0&&o.major().length>0}),o.save=function(){var t=ko.toJSON(o);$.ajax({url:"save_education",type:"POST",data:t,dataType:"json",contentType:"application/json; charset=utf-8",success:function(t){toastr.success("save success!"),e.OnUserEducationUpdate(t),o.modal.close()}})}};a.upsertUserEducation=function(e){var t=new r(a,e);t.template="add-education-template",showModal({viewModel:t,context:a}),$(".date").each(function(){$(this).datetimepicker({format:"yyyy-mm-dd",minView:2,autoclose:1,bootcssVer:3})}),$(".university").typeahead({items:6,source:universityList,showHintOnFocus:!0}),$(".major").typeahead({items:6,source:majorList,showHintOnFocus:!0})},a.addUserEducation=function(){a.upsertUserEducation()},a.editUserEducation=function(e){a.upsertUserEducation(e)},a.deleteUserEducation=function(e){confirm("delete current education?")&&$.ajax({url:"delete_education",type:"POST",data:ko.toJSON(e),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){toastr.success("save success!","",{positionClass:"toast-top-center"}),a.OnUserEducationUpdate(e)}})},a.OnUserEducationUpdate=function(e){ko.mapping.fromJS(e,{},a.userEducation)};var s=function(e,t){var o=this;o.id=ko.observable(0),o.fromDate=ko.observable(""),o.toDate=ko.observable(""),o.name=ko.observable(""),o.description=ko.observable(""),o.duty=ko.observable(""),t&&(o.id(t.id()),o.fromDate(t.fromDate()),o.toDate(t.toDate()),o.name(t.name()),o.description(t.description()),o.duty(t.duty())),o.enableSave=ko.pureComputed(function(){return o.fromDate().length>0&&o.name().length>0&&o.description().length>0}),o.save=function(){var t=ko.toJSON(o);$.ajax({url:"save_project",type:"POST",data:t,dataType:"json",contentType:"application/json; charset=utf-8",success:function(t){toastr.success("save success!"),e.OnUserProjectUpdate(t),o.modal.close()}})}};a.upsertUserProject=function(e){var t=new s(a,e);t.template="add-project-template",showModal({viewModel:t,context:a}),$(".date").each(function(){$(this).datetimepicker({format:"yyyy-mm-dd",minView:2,autoclose:1,bootcssVer:3})})},a.addUserProject=function(){a.upsertUserProject()},a.editUserProject=function(e){a.upsertUserProject(e)},a.deleteUserProject=function(e){confirm("delete current item?")&&$.ajax({url:"delete_project",type:"POST",data:ko.toJSON(e),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){toastr.success("save success!","",{positionClass:"toast-top-center"}),a.OnUserProjectUpdate(e)}})},a.OnUserProjectUpdate=function(e){ko.mapping.fromJS(e,{},a.userProject)};var i=function(e,t){var o=this;o.id=ko.observable(0),o.fromDate=ko.observable(""),o.toDate=ko.observable(""),o.company=ko.observable(""),o.description=ko.observable(""),o.position=ko.observable(""),t&&(o.id(t.id()),o.fromDate(t.fromDate()),o.toDate(t.toDate()),o.company(t.company()),o.description(t.description()),o.position(t.position())),o.enableSave=ko.pureComputed(function(){return o.fromDate().length>0&&o.company().length>0&&o.description().length>0}),o.save=function(){var t=ko.toJSON(o);$.ajax({url:"save_work",type:"POST",data:t,dataType:"json",contentType:"application/json; charset=utf-8",success:function(t){toastr.success("save success!"),e.OnUserWorkUpdate(t),o.modal.close()}})}};a.upsertUserWork=function(e){var t=new i(a,e);t.template="add-work-template",showModal({viewModel:t,context:a}),$(".date").each(function(){$(this).datetimepicker({format:"yyyy-mm-dd",minView:2,autoclose:1,bootcssVer:3})})},a.addUserWork=function(){a.upsertUserWork()},a.editUserWork=function(e){a.upsertUserWork(e)},a.deleteUserWork=function(e){confirm("delete current item?")&&$.ajax({url:"delete_work",type:"POST",data:ko.toJSON(e),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){toastr.success("save success!","",{positionClass:"toast-top-center"}),a.OnUserWorkUpdate(e)}})},a.OnUserWorkUpdate=function(e){ko.mapping.fromJS(e,{},a.userWork)},ko.applyBindings(a),$(".date").each(function(){$(this).datetimepicker({format:"yyyy-mm-dd",minView:2,autoclose:1,bootcssVer:3})})}$(document).ready(function(){$("#myApplyModal").on("show.bs.modal",function(e){var t=$(e.relatedTarget),o=t.data("id");$("#cancelLink").attr("href","cancel/"+o)}),$("#email").on("blur",function(){var e=$(this).val();e&&$.get("register/check_email",{email:e},function(e){"1"==e&&$("#email ~ .help-block").html("<label>Email has been used</label>").css("color","red")})}),toastr.options={closeButton:!0,newestOnTop:!0,positionClass:"toast-top-center"},$(document).ajaxError(function(e,t,o){200!=t.status&&toastr.error("Please check data integrity","Can't complete your request!",{positionClass:"toast-top-center"})})});